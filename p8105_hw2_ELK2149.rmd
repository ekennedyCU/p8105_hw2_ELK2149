---
title: "Homework 2"
output: github_document
date: "2025-09-28"
author: Evan Kennedy, ELK2149
---

```{r homework_2_setup, include = FALSE}

#setting up
#opening necessary libraries
library(moderndive)
library(tidyverse)
library(dplyr)
library(readxl)
library(knitr)

```

*** Problem 1 ***

```{r}
#separating out date variable, converting month into names of month, converting prez_dem and prez_gop into a single variable, and removing them along with day.

pols_month_df = 
    read_csv("./fivethirtyeight_datasets/pols-month.csv", na = c("NA", ".")) |>
  janitor::clean_names() |> 
  separate(mon, into = c("year", "month", "day"), sep = "-", convert = TRUE) |> 
  mutate(month = month.name[month]) |> 
  mutate(
    president = case_when(
      prez_dem == 1 ~ "dem",
      prez_gop == 1 ~ "gop")
) |> 
  select(-prez_dem, -prez_gop, -day)
  
pols_month_df
```

```{r}

#separating out date variable by /, converting year to YYYY, converting month to character format, arranging buy year, month, removing day to mirror above data frame.
snp_df = 
    read_csv("./fivethirtyeight_datasets/snp.csv", na = c("NA", ".")) |>
  janitor::clean_names()  |> 
  separate(date, into = c("month", "day", "year"), sep = "/", convert = TRUE) |> 
  mutate(year = ifelse(year >= 47, year + 1900, year + 2000)) |> 
  mutate(month = month.name[month]) |>
  arrange(year) |> 
  select(year, month, everything(), -day)

snp_df
```

```{r}

# pivoting long, converting month name to be consistent with other data sets.
unemployment_df = 
    read_csv("./fivethirtyeight_datasets/unemployment.csv", na = c("NA", ".")) |>
  janitor::clean_names() |> 
  pivot_longer(
    jan:dec,
    names_to = "month", 
    values_to = "%_UnEmp") |> 
 mutate(month = case_match(
    month,
    "jan" ~ "January",
    "feb" ~ "February",
    "mar" ~ "March",
    "apr" ~ "April",
    "may" ~ "May",
    "jun" ~ "June",
    "jul" ~ "July",
    "aug" ~ "August",
    "sep" ~ "September",
    "oct" ~ "October",
    "nov" ~ "November",
    "dec" ~ "December")
 )

unemployment_df
```

```{r}
#join SNP into POLS

pols_snp_df = 
  left_join(pols_month_df, snp_df, by = c("year", "month"))

pols_snp_df

#join unemployment

pols_snp_unemp_df = 
  left_join(pols_snp_df, unemployment_df, by = c("year", "month"))

pols_snp_unemp_df

```

The variables in this dataset are: `r (names(pols_snp_unemp_df))`. The data was collected between the dates of `r min(pols_snp_unemp_df$year)` and `r max(pols_snp_unemp_df$year)`. The dataset has `r nrow(pols_snp_unemp_df)` rows and `r ncol(pols_snp_unemp_df)` columns. pols_month_df contains data relating to the number of federal representatives, senators, state governors and president who represent each party in a given month and year. snp_df contains data on the S&P stock market score, by month and year. unemployment_df provides the percent of unemployment in the united states by month and year. 


*** Problem 2 ***

```{r}
# cleaning names, renaming weight and volume to simpler names, converting sports_balls to an interger, creating a categorical variable to differentiate data sets, turning year numeric to be congruent with other datasets.
mr_trash_df = 
  read_excel("./Trash_Data.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N653", na = c("NA", ".")) |>
  janitor::clean_names() |> 
  rename(weight = weight_tons, volume = volume_cubic_yards) |> 
  mutate(sports_balls = as.integer(round(sports_balls)),
         trash_wheel_name = "Mr",
         year = as.numeric(year)
         )

```

```{r}
# cleaning names, making weight and volume similar to past data set, creating categorical identifier for this data set
professor_trash_df = 
  read_excel("./Trash_Data.xlsx", sheet = "Professor Trash Wheel", range = "A2:M120", na = c("NA", ".")) |>
  janitor::clean_names() |> 
  rename(weight = weight_tons, volume = volume_cubic_yards) |> 
  mutate(trash_wheel_name = "Prof")

```

```{r}
# cleaning names, making weight and volume similar to past data set, creating categorical identifier for this data set
gwynnda_trash_df = 
  read_excel("./Trash_Data.xlsx", sheet = "Gwynnda Trash Wheel", range = "A2:L265", na = c("NA", ".")) |>
  janitor::clean_names() |> 
  rename(weight = weight_tons, volume = volume_cubic_yards) |> 
  mutate(trash_wheel_name = "Gwynnda")

```


```{r}
# binding datasets together (there is no variable to join them by as they are separate bins)
total_trash_df = 
  bind_rows(mr_trash_df, professor_trash_df, gwynnda_trash_df)
```

The variables in this dataset are: `r (names(total_trash_df))`. The data was collected between the dates of `r min(total_trash_df$year)` and `r max(total_trash_df$year)`. The dataset has a total of `r nrow(total_trash_df)` observations. The total weight of trash collected by Professor Trash Dumpster was  `r sum(professor_trash_df$weight)` tons. The total number of cigarette butts, collected by Gwynnda Trash Dumpster was `r format(sum(gwynnda_trash_df$cigarette_butts[gwynnda_trash_df$year == 2022 & gwynnda_trash_df$month == "June"]), scientific = FALSE)`.


*** Problem 3 ***

```{r}

# cleaning names for zip codes dataset
zip_codes_df = 
    read_csv("./zillow_data/Zip Codes.csv", na = c("NA", ".")) |>
  janitor::clean_names()
```

```{r}
# cleaning names for zillow dataset, pivoting long for zori scores across dates, changing zip_code column name to faciliate joining

zip_zori_df = 
    read_csv("./zillow_data/Zip_zori.csv", na = c("NA", ".")) |>
  janitor::clean_names() |> 
  pivot_longer(
    x2015_01_31:x2024_08_31,
    names_to = "date", 
    values_to = "zori") |> 
  rename(zip_code = region_name)
```

```{r}
# joining datasets
full_zip_df = 
  left_join(zip_codes_df, zip_zori_df, by = "zip_code")
```

```{r}
# cleaning dataset for redundant variables, separating out year month and day for upcoming analysis, regordering columns for ease of reading
full_zip_df = 
  full_zip_df |> 
  mutate(date = str_remove(date, "^x")) |> 
  separate(date, into = c("year", "month", "day"), sep = "_", convert = TRUE) |>
  mutate(month = month.name[month]) |> 
  select(
    zip_code, year, month, day, county, neighborhood, city, state, zori, everything(), -state_fips,
    -county_code, -region_type, -state_name, -metro, -file_date, -county_name
  )

```

The variables in this dataset are: `r (names(full_zip_df))`. The data was collected between the dates of `r min(full_zip_df$year, na.rm=TRUE)` and `r max(full_zip_df$year, na.rm=TRUE)`. 

The dataset has a total of `r nrow(full_zip_df)` observations. There are `r dplyr::n_distinct(full_zip_df$zip_code)` distinct zipcodes identified in this data set, and `r dplyr::n_distinct(full_zip_df$neighborhood)` neighborhoods.

The following is a list of zip codes not in the Zillow rental price dataset:
`r paste(unique(full_zip_df$zip_code[is.na(full_zip_df$size_rank)]))`

These are likely not in the zillow rental price dataset, because they are predominantly non-residential areas. For instance, 10464 is Pelham Bay Park, and 11414 is mostly cross bay blvd, a highway that extends across Jamaica Bay.

In Jan 2020, average rent cost was `r mean(full_zip_df$zori[full_zip_df$year == 2020 & full_zip_df$month == "January"], na.rm = TRUE)` with a range of `r min(full_zip_df$zori[full_zip_df$year == 2020 & full_zip_df$month == "January"], na.rm = TRUE)` to `r max(full_zip_df$zori[full_zip_df$year == 2020 & full_zip_df$month == "January"], na.rm = TRUE)`. 

In Jan 2021, average rent cost was `r mean(full_zip_df$zori[full_zip_df$year == 2021 & full_zip_df$month == "January"], na.rm = TRUE)` with a range of `r min(full_zip_df$zori[full_zip_df$year == 2021 & full_zip_df$month == "January"], na.rm = TRUE)` to `r max(full_zip_df$zori[full_zip_df$year == 2021 & full_zip_df$month == "January"], na.rm = TRUE)`. 

```{r}
# pivoting wide to help with comparison between 2020 and 2021 scores
Jan_compare_df = 
  full_zip_df |> 
  filter(month == "January", year %in% c(2020, 2021)) |> 
  select(zip_code, county, neighborhood, year, zori) |> 
  tidyr::pivot_wider(
    names_from = year,
    values_from = zori,
    names_prefix = "zori_"
  )
```

```{r}
# generating difference scores between 2021 and 2020
Jan_compare_df =
  Jan_compare_df |> 
   mutate(
    zori_diff = zori_2021 - zori_2020
  )
```

```{r}
# creating table of top 10 price drops, using Kable for cleaner output
top_drops = 
  Jan_compare_df |> 
  arrange(zori_diff) |> 
  slice_head(n = 10) |> 
  select(zip_code, county, neighborhood, zori_2020, zori_2021, zori_diff)

kable(
  top_drops,
  caption = "Top 10 ZIP Codes with Largest Rental Price Drops",
  col.names = c("ZIP Code", "Borough", "Neighborhood", "ZORI 2020", "ZORI 2021", "Change")
)
```

